<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vik Script IDE</title>
  <style>
    body {
      font-family: monospace;
      background-color: black;
      color: #39ff14;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }
    textarea {
      width: 90%;
      max-width: 900px;
      height: 300px;
      background: #000;
      color: #39ff14;
      border: 1px solid #39ff14;
      padding: 1rem;
      font-size: 1rem;
      resize: vertical;
      border-radius: 5px;
      font-family: monospace;
    }
    button {
      margin-top: 1rem;
      padding: 0.6rem 2rem;
      background: #39ff14;
      border: none;
      color: black;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      border-radius: 4px;
    }
    #output {
      width: 90%;
      max-width: 900px;
      margin-top: 1.5rem;
      padding: 1rem;
      background: #000;
      border: 1px solid #39ff14;
      color: #39ff14;
      white-space: pre-wrap;
      min-height: 200px;
      max-height: 400px;
      overflow-y: auto;
      border-radius: 5px;
      font-family: monospace;
      font-size: 1rem;
      line-height: 1.2;
    }
    .vik-line {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
    }
    .vik-input {
      background: transparent;
      border: none;
      color: #39ff14;
      font-family: monospace;
      font-size: 1rem;
      white-space: pre;
      display: inline-block;
      outline: none;
      min-width: 1ch;
    }
    h1 {
      color: #39ff14;
    }
    #output {
      width: 90%;
      max-width: 900px;
      margin-top: 1.5rem;
      padding: 1rem;
      background: #000;
      border: 1px solid #39ff14;
      color: #39ff14;
      white-space: pre-wrap;
      min-height: 200px;
      max-height: 400px;
      overflow-y: auto;
      border-radius: 5px;
      font-family: monospace;
      font-size: 1rem;
      line-height: 1.2;
      scrollbar-color: #39ff14 #000;
      scrollbar-width: thin;
    }
    ::-webkit-scrollbar {
      width: 10px;
    }
    ::-webkit-scrollbar-thumb {
      background-color: #39ff14;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-track {
      background: #000;
    }
   #help {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #0f0;
  color: #000;
  border: none;
  width: 40px;       /* Make width and height equal */
  height: 40px;
  font-weight: bold;
  font-size: 20px;
  border-radius: 50%; /* Perfect circle */
  cursor: pointer;
  text-align: center;
  line-height: 40px;  /* Vertically center the "?" */
  padding: 0;
}

#helpBox {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #000;
  color: #0f0;
  border: 2px solid #0f0;
  box-shadow: 0 0 20px #0f0;
  padding: 20px;
  display: none;
  width: 80vw;
  height: 60vh;
  overflow-y: auto;
  z-index: 100;
  white-space: pre-wrap;
  font-size: 14px;
  line-height: 1.4;
}

  </style>
</head>
<body>
  <h1>üìù Vik Script IDE</h1>

  <textarea id="editor" spellcheck="false">// This is a comment and will be ignored
//comment//
say This line will be shown.

say Hello get firstname get lastname!
say Nice to meet you, vari,firstname vari,lastname!

say hello world
get name
get secondname
say Hello vari,name vari,secondname!
getIn age
say You entered vari,age.
getIn score

i vari,score == 50
say On point!
eli vari,score >= 80
say Your score vari,score is excellent.
eli vari,score >= 50
say Your score vari,score is passing.
el
say Your score vari,score is failing.
enif

joi,vari fullname = name secondname
say Your full name is vari,fullname

pr powerval = 2 3
say 2 power 3 is vari,powerval

rn randnum 1 10
say Random number between 1 and 10: vari,randnum

get item1
get item2
get item3
ar list = vari,item1 vari,item2 vari,item3
say Your list items are: vari,list
say First item: vari,list[0]</textarea>

  <button onclick="runScript()">‚ñ∂Ô∏è Run</button>
  <div id="output"></div>
  <button id="help">?</button>
<div id="helpBox">
// Vik Script Syntax and Examples

// Input
get name What is your name?         // Get string input into variable 'name'
getIn age What is your age?         // Get integer input into variable 'age'

// Output
say Hello vari,name!                 // Print message, replace vari,name with variable value

// Variables
set condition_met = false            // Set variable

// Conditions (if, else if, else, end if)
i age >= 18
  say You are an adult.
  set condition_met = true
enif

i condition_met == false
  i age >= 13
    say You are a teenager.
    set condition_met = true
  enif
enif

i condition_met == false
  say You are a child.
enif

// Arrays
ar colors = red,green,blue           // Define array
say Your favorite colors might be vari,colors

// Math Operations
calc double_age = age a age          // a=add, s=subtract, m=multiply, d=divide
say Your age doubled is vari,double_age

// Functions
fun greet
  say Welcome vari,name to Vik Script!
endf

call greet

// Join Variables
joi,name double_age                  // Join two variables as string with space
say Joined: vari,name double_age
</div>


  <script>
    const editor = document.getElementById("editor");
    const outputBox = document.getElementById("output");

    let stringVars = {}, intVars = {}, listVars = {}, scriptLines = [], currentLine = 0, conditionStack = [];

    function replaceVars(line) {
      return line.replace(/vari,(\w+)(\[(\d+)\])?/g, (_, varName, __, index) => {
        if (index !== undefined) return listVars[varName]?.[index] ?? "[undefined]";
        if (stringVars[varName]) return stringVars[varName];
        if (intVars[varName] !== undefined) return intVars[varName];
        if (listVars[varName]) return listVars[varName].join(" ");
        return "[undefined]";
      });
    }

    function appendOutput(text, newline = true) {
      const span = document.createElement("span");
      span.textContent = text + (newline ? "\n" : "");
      outputBox.appendChild(span);
      outputBox.scrollTop = outputBox.scrollHeight;
    }

    function runNextLine() {
      if (currentLine >= scriptLines.length) return;
      let line = scriptLines[currentLine++].trim();
      if (!line || line.startsWith("//") || line.includes("//comment//")) return runNextLine();
      if (conditionStack.length && !conditionStack[conditionStack.length - 1].run) {
        if (!/^(el|eli|enif)/.test(line)) return runNextLine();
      }

      let tokens = line.split(" ");
      let cmd = tokens[0];

      if (cmd === "say") {
        let msg = line.slice(4).trim();
        let matches = [...msg.matchAll(/\bget\s+(\w+)\b/g)];
        if (matches.length) {
          const lineDiv = document.createElement("div");
          lineDiv.className = "vik-line";
          let parts = msg.split(/get\s+\w+/);
          let i = 0;

          function promptNext() {
            if (i >= matches.length) return runNextLine();

            const before = replaceVars(parts[i] || "");
            const varName = matches[i][1];
            const beforeSpan = document.createElement("span");
            beforeSpan.textContent = before;
            lineDiv.appendChild(beforeSpan);

            const input = document.createElement("span");
            input.className = "vik-input";
            input.contentEditable = true;
            input.spellcheck = false;
            lineDiv.appendChild(input);
            outputBox.appendChild(lineDiv);
            input.focus();

            input.addEventListener("keydown", function (e) {
              if (e.key === "Enter") {
                e.preventDefault();
                const val = input.textContent.trim();
                stringVars[varName] = val;
                const finalText = document.createTextNode(val);
                input.replaceWith(finalText);
                i++;
                promptNext();
              }
            });
          }

          promptNext();
        } else {
          appendOutput(replaceVars(msg));
          runNextLine();
        }

      } else if (cmd === "get") {
        let varName = tokens[1];
        askInput(`${varName}: `, val => { stringVars[varName] = val; runNextLine(); });
      } else if (cmd === "getIn") {
        let varName = tokens[1];
        askInput(`${varName}: `, val => {
          intVars[varName] = parseInt(val) || 0;
          runNextLine();
        });
      } else if (cmd === "joi,vari") {
        let varName = tokens[1];
        if (tokens[2] === "=") stringVars[varName] = `${stringVars[tokens[3]]} ${stringVars[tokens[4]]}`;
        runNextLine();
      } else if (cmd === "pr") {
        if (tokens[2] === "=") intVars[tokens[1]] = Math.pow(+tokens[3], +tokens[4]);
        runNextLine();
      } else if (cmd === "rn") {
        let [_, varName, min, max] = tokens;
        min = +min; max = +max;
        intVars[varName] = Math.floor(Math.random() * (max - min + 1)) + min;
        runNextLine();
      } else if (cmd === "ar") {
        if (tokens[2] === "=") {
          listVars[tokens[1]] = tokens.slice(3).map(t => {
            if (t.startsWith("vari,")) {
              let key = t.slice(5);
              return stringVars[key] ?? intVars[key] ?? "[undefined]";
            }
            return t;
          });
        }
        runNextLine();
      } else if (cmd === "i" || cmd === "eli" || cmd === "el") {
        let cond = false;
        if (cmd !== "el") {
          let [left, op, right] = tokens.slice(1);
          left = left.startsWith("vari,") ? intVars[left.slice(5)] ?? 0 : +left;
          right = right.startsWith("vari,") ? intVars[right.slice(5)] ?? 0 : +right;
          cond = eval(`${left} ${op} ${right}`);
        }
        if (cmd === "i") conditionStack.push({run: cond, triggered: cond});
        else if (cmd === "eli" && conditionStack.length) {
          let top = conditionStack[conditionStack.length - 1];
          if (!top.triggered) top.run = top.triggered = cond; else top.run = false;
        } else if (cmd === "el" && conditionStack.length) {
          let top = conditionStack[conditionStack.length - 1];
          if (!top.triggered) top.run = top.triggered = true; else top.run = false;
        }
        runNextLine();
      } else if (cmd === "enif") {
        if (conditionStack.length) conditionStack.pop();
        runNextLine();
      } else {
        appendOutput(`Unknown command: ${cmd}`);
        runNextLine();
      }
    }

    function askInput(label, callback) {
      const line = document.createElement("div");
      line.className = "vik-line";
      const span = document.createElement("span");
      span.textContent = label;
      line.appendChild(span);
      const input = document.createElement("span");
      input.className = "vik-input";
      input.contentEditable = true;
      input.spellcheck = false;
      line.appendChild(input);
      outputBox.appendChild(line);
      input.focus();
      input.addEventListener("keydown", e => {
        if (e.key === "Enter") {
          e.preventDefault();
          const val = input.textContent.trim();
          const finalLine = document.createElement("div");
          finalLine.className = "vik-line";
          finalLine.textContent = label + val;
          line.replaceWith(finalLine);
          callback(val);
        }
      });
    }

    function runScript() {
      outputBox.textContent = "";
      stringVars = {}; intVars = {}; listVars = {}; conditionStack = [];
      scriptLines = editor.value.split("\n");
      currentLine = 0;
      runNextLine();
    }
   const helpBtn = document.getElementById('help');
const helpBox = document.getElementById('helpBox');

helpBtn.onclick = () => {
  helpBox.style.display = helpBox.style.display === 'block' ? 'none' : 'block';
};

  </script>
</body>
</html>
