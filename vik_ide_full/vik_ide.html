<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vik Script IDE</title>
  <style>
    body {
      font-family: monospace;
      background-color: black;
      color: #39ff14;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }

    textarea {
      width: 90%;
      max-width: 900px;
      height: 300px;
      background: #000;
      color: #39ff14;
      border: 1px solid #39ff14;
      padding: 1rem;
      font-size: 1rem;
      resize: vertical;
      border-radius: 5px;
      font-family: monospace;
    }

    button {
      margin-top: 1rem;
      padding: 0.6rem 2rem;
      background: #39ff14;
      border: none;
      color: black;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      border-radius: 4px;
    }

    #output {
      width: 90%;
      max-width: 900px;
      margin-top: 1.5rem;
      padding: 1rem;
      background: #000;
      border: 1px solid #39ff14;
      color: #39ff14;
      white-space: pre-wrap;
      min-height: 200px;
      max-height: 400px;
      overflow-y: auto;
      border-radius: 5px;
      font-family: monospace;
      font-size: 1rem;
      line-height: 1.2;
      scrollbar-color: #39ff14 #000;
      scrollbar-width: thin;
    }

    ::-webkit-scrollbar {
      width: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background-color: #39ff14;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-track {
      background: #000;
    }

    .vik-line {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
    }

    .vik-input {
      background: transparent;
      border: none;
      color: #39ff14;
      font-family: monospace;
      font-size: 1rem;
      font-weight: normal;
      letter-spacing: normal;
      white-space: pre;
      display: inline-block;
      outline: none;
      padding: 0;
      margin: 0;
      line-height: 1.2;
      min-width: 1ch;
    }

    h1 {
      color: #39ff14;
    }
  </style>
</head>
<body>
  <h1>üìù Vik Script IDE</h1>

  <textarea id="editor" spellcheck="false">say hello world
get name
get secondname
say Hello vari,name vari,secondname!
getIn age
say You entered vari,age.
getIn score

i vari,score == 50
say On point!
eli vari,score >= 80
say Your score vari,score is excellent.
eli vari,score >= 50
say Your score vari,score is passing.
el
say Your score vari,score is failing.
enif

joi,vari fullname = name secondname
say Your full name is vari,fullname

pr powerval = 2 3
say 2 power 3 is vari,powerval

rn randnum 1 10
say Random number between 1 and 10: vari,randnum

get item1
get item2
get item3
ar list = vari,item1 vari,item2 vari,item3
say Your list items are: vari,list
say First item: vari,list[0]

</textarea>

  <button onclick="runScript()">‚ñ∂Ô∏è Run</button>
  <div id="output"></div>

  <script>
(function(){
const editor = document.getElementById("editor");
const outputBox = document.getElementById("output");

let stringVars = {};
let intVars = {};
let listVars = {};
let scriptLines = [];
let currentLine = 0;
let conditionStack = [];

function replaceVars(line) {
  return line.replace(/vari,(\w+)(\[(\d+)\])?/g, (_, varName, __, index) => {
    if (index !== undefined) {
      if (listVars[varName] && listVars[varName][index] !== undefined) return listVars[varName][index];
      return "[undefined]";
    }
    if (stringVars[varName]) return stringVars[varName];
    if (intVars[varName] !== undefined) return intVars[varName].toString();
    if (listVars[varName]) return listVars[varName].join(" ");
    return "[undefined]";
  });
}

function appendOutput(text, newline = true) {
  const span = document.createElement("span");
  span.textContent = text + (newline ? "\n" : "");
  outputBox.appendChild(span);
  outputBox.scrollTop = outputBox.scrollHeight;
}

function askInput(promptText, callback) {
  const line = document.createElement("div");
  line.className = "vik-line";

  const promptSpan = document.createElement("span");
  promptSpan.textContent = promptText;
  line.appendChild(promptSpan);

  const input = document.createElement("span");
  input.className = "vik-input";
  input.contentEditable = true;
  input.spellcheck = false;
  line.appendChild(input);

  outputBox.appendChild(line);
  outputBox.scrollTop = outputBox.scrollHeight;
  input.focus();

  input.addEventListener("keydown", function (e) {
    if (e.key === "Enter") {
      e.preventDefault();
      const value = input.textContent.trim();
      const fullText = document.createElement("div");
      fullText.className = "vik-line";
      fullText.textContent = promptText + value;
      line.replaceWith(fullText);
      callback(value);
    }
  });
}

function parseValue(token) {
  if (!isNaN(token)) return parseInt(token);
  if (intVars[token] !== undefined) return intVars[token];
  return 0;
}

function runNextLine() {
  if (currentLine >= scriptLines.length) return;
  let line = scriptLines[currentLine++].trim();
  if (!line || line.startsWith("!comment!")) return runNextLine();

  if (conditionStack.length > 0 && !conditionStack[conditionStack.length - 1].run) {
    if (/^(el|eli|enif)$/.test(line.split(" ")[0])) {} else return runNextLine();
  }

  let tokens = line.split(" ");
  let cmd = tokens[0];

  if (cmd === "say") {
    appendOutput(replaceVars(line.slice(4).trim()));
    runNextLine();
  } else if (cmd === "get") {
    askInput(tokens[1] + ": ", val => { stringVars[tokens[1]] = val; runNextLine(); });
  } else if (cmd === "getIn") {
    askInput(tokens[1] + ": ", val => { intVars[tokens[1]] = parseInt(val) || 0; runNextLine(); });
  } else if (cmd === "calc") {
    const [_, varName, eq, n1, op, n2] = tokens;
    if (eq !== "=") appendOutput("Syntax error in calc.");
    else {
      const num1 = parseValue(n1), num2 = parseValue(n2);
      switch (op) {
        case 'a': intVars[varName] = num1 + num2; break;
        case 's': intVars[varName] = num1 - num2; break;
        case 'm': intVars[varName] = num1 * num2; break;
        case 'd': intVars[varName] = num2 ? Math.floor(num1 / num2) : (appendOutput("Division by 0 error."), undefined); break;
        default: appendOutput("Unknown operator in calc.");
      }
    }
    runNextLine();
  } else {
    appendOutput(`Unknown command: ${cmd}`);
    runNextLine();
  }
}

window.runScript = function() {
  outputBox.textContent = "";
  stringVars = {}; intVars = {}; listVars = {};
  conditionStack = []; currentLine = 0;
  scriptLines = editor.value.split("\n");
  runNextLine();
}
})();
  </script>
</body>
</html>
